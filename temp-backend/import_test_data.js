const { query } = require('./config/database');

async function importTestData() {
  try {
    console.log('📥 开始导入测试数据...');
    
    // 清空现有任务数据
    await query('DELETE FROM tasks WHERE student_id IN ("ST001", "ST002")');
    console.log('🗑️ 清空现有任务数据');
    
    // 测试数据 - 设置7月5日为休息日，看是否在7月6日显示
    const testTasks = [
      // 7月1日 - 正常任务
      ['ST001', '2025-07-01', '专业课', '数据结构与算法基础'],
      ['ST001', '2025-07-01', '数学', '高等数学微分学'],
      ['ST001', '2025-07-01', '英语', '考研词汇Unit1-10'],
      ['ST002', '2025-07-01', '专业课', '数据结构与算法基础'],
      ['ST002', '2025-07-01', '数学', '高等数学微分学'],
      ['ST002', '2025-07-01', '英语', '考研词汇Unit1-10'],
      
      // 7月2日 - 正常任务
      ['ST001', '2025-07-02', '专业课', '操作系统进程管理'],
      ['ST001', '2025-07-02', '数学', '高等数学积分学'],
      ['ST001', '2025-07-02', '英语', '阅读理解专项训练'],
      ['ST002', '2025-07-02', '专业课', '操作系统进程管理'],
      ['ST002', '2025-07-02', '数学', '高等数学积分学'],
      ['ST002', '2025-07-02', '英语', '阅读理解专项训练'],
      
      // 7月3日 - 正常任务
      ['ST001', '2025-07-03', '专业课', '计算机网络TCP/IP'],
      ['ST001', '2025-07-03', '数学', '线性代数矩阵运算'],
      ['ST001', '2025-07-03', '英语', '写作技巧训练'],
      ['ST002', '2025-07-03', '专业课', '计算机网络TCP/IP'],
      ['ST002', '2025-07-03', '数学', '线性代数矩阵运算'],
      ['ST002', '2025-07-03', '英语', '写作技巧训练'],
      
      // 7月4日 - 正常任务
      ['ST001', '2025-07-04', '专业课', '数据库系统原理'],
      ['ST001', '2025-07-04', '数学', '概率论基础概念'],
      ['ST001', '2025-07-04', '英语', '翻译技巧练习'],
      ['ST002', '2025-07-04', '专业课', '数据库系统原理'],
      ['ST002', '2025-07-04', '数学', '概率论基础概念'],
      ['ST002', '2025-07-04', '英语', '翻译技巧练习'],
      
      // 7月5日 - 休息日（测试是否在7月6日显示）
      ['ST001', '2025-07-05', '休息', '测试休息日偏移-应该显示在7月6日'],
      ['ST002', '2025-07-05', '休息', '测试休息日偏移-应该显示在7月6日'],
      
      // 7月6日 - 正常任务
      ['ST001', '2025-07-06', '专业课', '编译原理词法分析'],
      ['ST001', '2025-07-06', '数学', '离散数学图论'],
      ['ST001', '2025-07-06', '英语', '语法专项复习'],
      ['ST002', '2025-07-06', '专业课', '编译原理词法分析'],
      ['ST002', '2025-07-06', '数学', '离散数学图论'],
      ['ST002', '2025-07-06', '英语', '语法专项复习'],
      
      // 7月7日 - 正常任务
      ['ST001', '2025-07-07', '专业课', '人工智能机器学习'],
      ['ST001', '2025-07-07', '数学', '数值分析方法'],
      ['ST001', '2025-07-07', '英语', '完形填空练习'],
      ['ST002', '2025-07-07', '专业课', '人工智能机器学习'],
      ['ST002', '2025-07-07', '数学', '数值分析方法'],
      ['ST002', '2025-07-07', '英语', '完形填空练习'],
      
      // 7月12日 - 休息日（测试是否在7月13日显示）
      ['ST001', '2025-07-12', '休息', '测试休息日偏移-应该显示在7月13日'],
      ['ST002', '2025-07-12', '休息', '测试休息日偏移-应该显示在7月13日'],
      
      // 7月13日 - 正常任务
      ['ST001', '2025-07-13', '专业课', '分布式系统架构'],
      ['ST001', '2025-07-13', '数学', '泛函分析入门'],
      ['ST001', '2025-07-13', '英语', '词汇记忆技巧'],
      ['ST002', '2025-07-13', '专业课', '分布式系统架构'],
      ['ST002', '2025-07-13', '数学', '泛函分析入门'],
      ['ST002', '2025-07-13', '英语', '词汇记忆技巧']
    ];
    
    // 插入测试数据
    for (const [studentId, date, type, title] of testTasks) {
      const taskId = `${studentId}_${date}_${type}_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
      
      await query(
        'INSERT INTO tasks (id, student_id, task_date, task_type, title) VALUES (?, ?, ?, ?, ?)',
        [taskId, studentId, date, type, title]
      );
    }
    
    console.log(`✅ 成功导入 ${testTasks.length} 个测试任务`);
    
    // 验证导入结果
    const result = await query(
      'SELECT task_date, task_type, COUNT(*) as count FROM tasks WHERE student_id = "ST001" GROUP BY task_date, task_type ORDER BY task_date'
    );
    
    console.log('📊 导入结果验证:');
    result.forEach(row => {
      console.log(`  ${row.task_date}: ${row.task_type} (${row.count}个)`);
    });
    
    console.log('\n🎯 测试重点:');
    console.log('  - 7月5日设置为休息日，检查是否在7月6日显示');
    console.log('  - 7月12日设置为休息日，检查是否在7月13日显示');
    
    process.exit(0);
  } catch (error) {
    console.error('❌ 导入测试数据失败:', error);
    process.exit(1);
  }
}

importTestData();
