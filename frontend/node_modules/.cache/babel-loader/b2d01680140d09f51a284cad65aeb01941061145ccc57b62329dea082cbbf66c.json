{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useApp}from'../contexts/AppContext';import{taskAPI}from'../services/api';import TodayScreen from'./TodayScreen';import MonthScreen from'./MonthScreen';import ProfileScreen from'./ProfileScreen';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const StudentApp=()=>{const{user,systemDate,advanceDay,resetToInitialDate,initialDate,logout}=useApp();const[activeTab,setActiveTab]=useState('当日任务');const[reminderShown,setReminderShown]=useState(false);const[alertVisible,setAlertVisible]=useState(false);// 检查今日是否有任务的提醒逻辑\nuseEffect(()=>{const checkTodayTasks=async()=>{if(user&&!reminderShown){try{// 格式化日期避免时区问题\nconst today=(()=>{const year=systemDate.getFullYear();const month=String(systemDate.getMonth()+1).padStart(2,'0');const day=String(systemDate.getDate()).padStart(2,'0');return`${year}-${month}-${day}`;})();const response=await taskAPI.getTasks(today,today);if(response.success&&response.data){// 后端返回的是按日期分组的对象，需要提取今天的任务\nconst todayTasks=response.data[today]||[];if(todayTasks.length>0){// 检查是否有非休息任务\nconst hasActiveTasks=todayTasks.some(task=>task.type!=='休息'&&task.title!=='今日休息调整状态');if(hasActiveTasks){setAlertVisible(true);}}}}catch(error){console.error('检查今日任务失败:',error);}setReminderShown(true);}};checkTodayTasks();},[user,reminderShown,systemDate]);useEffect(()=>{if(!user){setReminderShown(false);}},[user]);const NavItem=_ref=>{let{name,icon}=_ref;return/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setActiveTab(name),className:`flex-1 flex flex-col items-center justify-center p-2 ${activeTab===name?'text-blue-500':'text-gray-500'}`,children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-xl mb-1\",children:icon}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs\",children:name})]});};const ConfirmationModal=_ref2=>{let{visible,onClose,title,message}=_ref2;if(!visible)return null;return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-xl p-6 w-11/12 max-w-sm\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-bold\",children:title}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 my-4\",children:message}),/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-end\",children:/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"px-4 py-2 bg-blue-600 text-white rounded\",children:\"\\u786E\\u8BA4\"})})]})});};return/*#__PURE__*/_jsxs(\"div\",{className:\"w-full min-h-screen flex flex-col bg-gray-50\",children:[/*#__PURE__*/_jsx(ConfirmationModal,{visible:alertVisible,onClose:()=>setAlertVisible(false),title:\"\\u6BCF\\u65E5\\u63D0\\u9192\",message:\"\\u540C\\u5B66\\u4F60\\u597D\\uFF0C\\u4ECA\\u5929\\u7684\\u5B66\\u4E60\\u4EFB\\u52A1\\u5DF2\\u7ECF\\u53D1\\u5E03\\uFF0C\\u8BF7\\u8BB0\\u5F97\\u6309\\u65F6\\u5B8C\\u6210\\u54E6\\uFF01\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-yellow-100 p-2 text-center text-xs border-b\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center space-x-2 flex-wrap\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"mr-2\",children:\"\\uD83E\\uDDEA \\u6D4B\\u8BD5\\u65E5\\u671F\\u63A7\\u5236: \"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-blue-700 font-semibold\",children:[\"\\u5F53\\u524D: \",systemDate.toLocaleDateString('zh-CN')]}),/*#__PURE__*/_jsx(\"button\",{onClick:async()=>{try{await advanceDay();console.log('日期已前进，系统将自动刷新任务数据');}catch(error){console.error('前进日期失败:',error);alert('前进日期失败: '+error.message);}},className:\"mx-1 px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors\",children:\"+1\\u5929\"}),/*#__PURE__*/_jsx(\"button\",{onClick:resetToInitialDate,className:\"mx-1 px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition-colors\",children:\"\\u91CD\\u7F6E\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-1 text-gray-600 text-center\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u53EA\\u80FD\\u524D\\u8FDB\\u5230\\u672A\\u6765\\u65E5\\u671F\\uFF0C\\u91CD\\u7F6E\\u4F1A\\u6E05\\u7A7A\\u6240\\u6709\\u4EFB\\u52A1\\u6570\\u636E\\u5E76\\u56DE\\u5230\\u521D\\u59CB\\u65E5\\u671F (\",initialDate.toLocaleDateString('zh-CN'),\")\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-blue-600 mt-1\",children:\"\\u65E5\\u671F\\u5207\\u6362\\u65F6\\u81EA\\u52A8\\u5904\\u7406\\u524D\\u4E00\\u5929\\u672A\\u5B8C\\u6210\\u4EFB\\u52A1\\uFF08\\u5C11\\u4E8E3\\u4E2A\\u7ED3\\u8F6C\\uFF0C3\\u4E2A\\u53CA\\u4EE5\\u4E0A\\u987A\\u5EF6\\uFF09\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-red-600 mt-1\",children:\"\\u26A0\\uFE0F \\u91CD\\u7F6E\\u529F\\u80FD\\u4F1A\\u5B8C\\u5168\\u5220\\u9664\\u6240\\u6709\\u4EFB\\u52A1\\u3001\\u8BF7\\u5047\\u8BB0\\u5F55\\u7B49\\u6570\\u636E\\uFF0C\\u7528\\u4E8E\\u6D4B\\u8BD5\\u91CD\\u65B0\\u5BFC\\u5165\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-blue-600 text-white p-4 flex justify-between items-center\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-lg font-bold\",children:\"\\u8003\\u7814\\u4EFB\\u52A1\\u7BA1\\u7406\\u7CFB\\u7EDF - \\u5B66\\u751F\\u7AEF\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{if(window.confirm('确定要退出登录吗？')){logout();}},className:\"px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition-colors text-sm\",children:\"\\u9000\\u51FA\\u767B\\u5F55\"})]}),/*#__PURE__*/_jsxs(\"main\",{className:\"flex-1 overflow-hidden flex flex-col bg-white\",children:[activeTab==='当日任务'&&/*#__PURE__*/_jsx(TodayScreen,{}),activeTab==='月度任务'&&/*#__PURE__*/_jsx(MonthScreen,{}),activeTab==='个人中心'&&/*#__PURE__*/_jsx(ProfileScreen,{})]}),/*#__PURE__*/_jsxs(\"nav\",{className:\"flex bg-white border-t shadow-lg md:shadow-md sticky bottom-0\",children:[/*#__PURE__*/_jsx(NavItem,{name:\"\\u5F53\\u65E5\\u4EFB\\u52A1\",icon:\"\\uD83D\\uDCC5\"}),/*#__PURE__*/_jsx(NavItem,{name:\"\\u6708\\u5EA6\\u4EFB\\u52A1\",icon:\"\\uD83D\\uDDD3\\uFE0F\"}),/*#__PURE__*/_jsx(NavItem,{name:\"\\u4E2A\\u4EBA\\u4E2D\\u5FC3\",icon:\"\\uD83D\\uDC64\"})]})]});};export default StudentApp;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}