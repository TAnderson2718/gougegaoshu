{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useApp}from'../contexts/AppContext';import{useNavigate}from'react-router-dom';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Login=()=>{const{login,loading,error,user,isAuthenticated}=useApp();const navigate=useNavigate();const[formData,setFormData]=useState({studentId:'',password:'',rememberMe:false});const[loginError,setLoginError]=useState('');const[quickLoginStatus,setQuickLoginStatus]=useState('');const[hasRedirected,setHasRedirected]=useState(false);// è°ƒè¯•ï¼šç›‘æŽ§çŠ¶æ€å˜åŒ–\nconsole.log('ðŸ” Login ç»„ä»¶æ¸²æŸ“ - å½“å‰çŠ¶æ€:',{isAuthenticated,user:user?`${user.id||user.studentId}`:null,hasRedirected,loading,timestamp:new Date().toISOString()});// åŠ è½½ä¿å­˜çš„ç™»å½•ä¿¡æ¯\nuseEffect(()=>{try{const savedCredentials=localStorage.getItem('savedCredentials');if(savedCredentials){const{studentId,password}=JSON.parse(savedCredentials);setFormData(prev=>({...prev,studentId,password,rememberMe:true}));}}catch(error){console.error('åŠ è½½ä¿å­˜çš„ç™»å½•ä¿¡æ¯å¤±è´¥:',error);}},[]);// ç›‘å¬è®¤è¯çŠ¶æ€å˜åŒ–ï¼Œç™»å½•æˆåŠŸåŽè‡ªåŠ¨é‡å®šå‘\nuseEffect(()=>{console.log('ðŸ” useEffect è§¦å‘ - çŠ¶æ€æ£€æŸ¥:',{isAuthenticated,user:user?`${user.id||user.studentId}`:null,hasRedirected,userObject:user});console.log('ðŸ” æ¡ä»¶æ£€æŸ¥:',{'isAuthenticated':isAuthenticated,'userå­˜åœ¨':!!user,'hasRedirected':hasRedirected,'æ¡ä»¶æ»¡è¶³':isAuthenticated&&user&&!hasRedirected});if(isAuthenticated&&user&&!hasRedirected){var _user$studentId,_user$id;console.log('ðŸ”„ æ£€æµ‹åˆ°ç™»å½•æˆåŠŸï¼Œå‡†å¤‡é‡å®šå‘...');console.log('ðŸ‘¤ ç”¨æˆ·ä¿¡æ¯:',user);// æ£€æŸ¥æ˜¯å¦æ˜¯ç®¡ç†å‘˜\nconst isAdmin=user&&(user.userType==='admin'||user.role==='admin'||((_user$studentId=user.studentId)===null||_user$studentId===void 0?void 0:_user$studentId.startsWith('ADMIN'))||((_user$id=user.id)===null||_user$id===void 0?void 0:_user$id.startsWith('ADMIN'))||user.studentId==='ADMIN'||user.id==='ADMIN');console.log('ðŸ” ç”¨æˆ·è§’è‰²æ£€æŸ¥:',{isAdmin,userType:user.userType,id:user.id});// è®¾ç½®é‡å®šå‘æ ‡å¿—ï¼Œé˜²æ­¢é‡å¤é‡å®šå‘\nsetHasRedirected(true);// æ ¹æ®ç”¨æˆ·è§’è‰²é‡å®šå‘\nif(isAdmin){console.log('âž¡ï¸ é‡å®šå‘åˆ°ç®¡ç†å‘˜ç«¯...');navigate('/admin',{replace:true});}else{console.log('âž¡ï¸ é‡å®šå‘åˆ°å­¦ç”Ÿç«¯...');navigate('/student',{replace:true});}}},[isAuthenticated,user,hasRedirected,navigate]);const handleChange=e=>{const{name,value,type,checked}=e.target;setFormData(prev=>({...prev,[name]:type==='checkbox'?checked:value}));};const handleSubmit=async e=>{e.preventDefault();setLoginError('');if(!formData.studentId.trim()||!formData.password.trim()){setLoginError('è¯·è¾“å…¥å­¦ç”ŸIDå’Œå¯†ç ');return;}console.log('ðŸš€ å¼€å§‹ç™»å½•æµç¨‹...');const result=await login(formData.studentId.toUpperCase().trim(),formData.password,formData.rememberMe);console.log('ðŸ“‹ ç™»å½•ç»“æžœ:',result);if(!result.success){setLoginError(result.message);}else{console.log('âœ… ç™»å½•æˆåŠŸï¼Œç­‰å¾…çŠ¶æ€æ›´æ–°å’Œé‡å®šå‘...');}};// å¿«é€Ÿç™»å½•åŠŸèƒ½\nconst handleQuickLogin=async(studentId,password)=>{console.log(`ðŸš€ å¿«é€Ÿç™»å½•å¼€å§‹: ${studentId}`);setLoginError('');setQuickLoginStatus(`æ­£åœ¨ç™»å½• ${studentId}...`);try{console.log(`ðŸ“ž è°ƒç”¨ login å‡½æ•°...`);const result=await login(studentId,password,false);console.log(`ðŸ“Š ç™»å½•ç»“æžœ:`,result);if(!result||!result.success){const errorMsg=(result===null||result===void 0?void 0:result.message)||'ç™»å½•å¤±è´¥ï¼ŒæœªçŸ¥é”™è¯¯';console.error(`âŒ ç™»å½•å¤±è´¥: ${errorMsg}`);setLoginError(errorMsg);setQuickLoginStatus('');}else{console.log(`âœ… ç™»å½•æˆåŠŸ: ${studentId}`);setQuickLoginStatus(`ç™»å½•æˆåŠŸï¼Œæ­£åœ¨è·³è½¬...`);// ç­‰å¾…çŠ¶æ€æ›´æ–°\nsetTimeout(()=>{console.log(`ðŸ‘¤ ç™»å½•åŽç”¨æˆ·çŠ¶æ€:`,user);console.log(`ðŸ” ç™»å½•åŽè®¤è¯çŠ¶æ€:`,{isAuthenticated,loading});console.log(`ðŸ’¾ localStorage token:`,localStorage.getItem('token'));console.log(`ðŸ’¾ localStorage user:`,localStorage.getItem('user'));},500);}}catch(error){console.error(`âŒ ç™»å½•å¼‚å¸¸:`,error);console.error(`âŒ é”™è¯¯å †æ ˆ:`,error.stack);setLoginError(error.message||'ç™»å½•è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯');setQuickLoginStatus('');}};return/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-col items-center justify-center h-full p-8 bg-gray-100\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"w-full max-w-md\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center mb-8\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"https://i.postimg.cc/pdmk3gkb/e9398b353525a8d77a431307d7e0cd1a.png\",alt:\"Logo\",className:\"w-16 h-16 mx-auto mb-4 object-contain\"}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-800\",children:\"\\u8003\\u7814\\u4EFB\\u52A1\\u7BA1\\u7406\\u7CFB\\u7EDF\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mt-2\",children:\"\\u8BF7\\u9009\\u62E9\\u60A8\\u7684\\u8EAB\\u4EFD\\u767B\\u5F55\"})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"studentId\",placeholder:\"\\u7528\\u6237ID (\\u5B66\\u751F: ST001, \\u7BA1\\u7406\\u5458: ADMIN)\",value:formData.studentId,onChange:handleChange,className:\"w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500\",disabled:loading})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"password\",name:\"password\",placeholder:\"\\u5BC6\\u7801\",value:formData.password,onChange:handleChange,className:\"w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500\",disabled:loading})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"input\",{id:\"remember-me\",name:\"rememberMe\",type:\"checkbox\",checked:formData.rememberMe,onChange:handleChange,className:\"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\",disabled:loading}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"remember-me\",className:\"ml-2 block text-sm text-gray-900\",children:\"\\u8BB0\\u4F4F\\u5BC6\\u7801\"})]}),(loginError||error)&&/*#__PURE__*/_jsx(\"div\",{className:\"p-3 bg-red-100 border border-red-400 text-red-700 rounded-md text-sm\",children:loginError||error}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:loading,className:\"w-full bg-blue-600 text-white p-3 rounded-md font-semibold hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed\",children:loading?'ç™»å½•ä¸­...':'ç™»å½•'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 text-center text-sm text-gray-500\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\u5B66\\u751F\\u521D\\u59CB\\u5BC6\\u7801: Hello888\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u7BA1\\u7406\\u5458\\u521D\\u59CB\\u5BC6\\u7801: AdminPass123\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-md\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-yellow-800 mb-3 font-medium\",children:\"\\uD83E\\uDDEA \\u6D4B\\u8BD5\\u5FEB\\u901F\\u767B\\u5F55\"}),quickLoginStatus&&/*#__PURE__*/_jsx(\"div\",{className:\"mb-3 p-2 bg-blue-100 border border-blue-300 text-blue-700 rounded text-sm\",children:quickLoginStatus}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-600 mb-2\",children:\"\\u5B66\\u751F\\u8D26\\u53F7:\"}),/*#__PURE__*/_jsx(\"button\",{onClick:e=>{e.preventDefault();e.stopPropagation();handleQuickLogin('ST001','Hello888');},disabled:loading,type:\"button\",className:\"w-full bg-blue-500 text-white p-2 rounded text-sm hover:bg-blue-600 disabled:opacity-50\",children:\"\\u5B66\\u751FST001 (\\u521D\\u59CB\\u5BC6\\u7801)\"}),/*#__PURE__*/_jsx(\"button\",{onClick:e=>{e.preventDefault();e.stopPropagation();handleQuickLogin('ST002','Hello888');},disabled:loading,type:\"button\",className:\"w-full bg-blue-500 text-white p-2 rounded text-sm hover:bg-blue-600 disabled:opacity-50\",children:\"\\u5B66\\u751FST002 (\\u521D\\u59CB\\u5BC6\\u7801)\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-600 mb-2 mt-4\",children:\"\\u7BA1\\u7406\\u5458\\u8D26\\u53F7:\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleQuickLogin('ADMIN','AdminPass123'),disabled:loading,className:\"w-full bg-green-500 text-white p-2 rounded text-sm hover:bg-green-600 disabled:opacity-50\",children:\"\\u7BA1\\u7406\\u5458ADMIN (\\u521D\\u59CB\\u5BC6\\u7801)\"})]})]})]})});};export default Login;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}