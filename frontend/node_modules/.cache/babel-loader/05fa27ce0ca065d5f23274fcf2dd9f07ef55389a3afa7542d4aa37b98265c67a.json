{"ast":null,"code":"import React from'react';import{BrowserRouter as Router,Routes,Route,Navigate}from'react-router-dom';import{AppProvider,useApp}from'./contexts/AppContext';import Login from'./components/Login';import StudentApp from'./components/StudentApp';import AdminDashboard from'./components/AdminDashboard';import'./App.css';// 路由保护组件\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ProtectedRoute=_ref=>{let{children}=_ref;const{isAuthenticated,loading}=useApp();if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center h-screen\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"\\u52A0\\u8F7D\\u4E2D...\"})]})});}return isAuthenticated?children:/*#__PURE__*/_jsx(Navigate,{to:\"/\",replace:true});};// 统一主页面 - 根据用户角色自动重定向\nconst HomePage=()=>{var _user$studentId,_user$id;const{user,isAuthenticated,loading}=useApp();if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center h-screen\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"\\u52A0\\u8F7D\\u4E2D...\"})]})});}// 如果未登录，显示登录页面\nif(!isAuthenticated){return/*#__PURE__*/_jsx(Login,{});}// 检查是否是管理员\nconst isAdmin=user&&(user.userType==='admin'||user.role==='admin'||((_user$studentId=user.studentId)===null||_user$studentId===void 0?void 0:_user$studentId.startsWith('ADMIN'))||((_user$id=user.id)===null||_user$id===void 0?void 0:_user$id.startsWith('ADMIN'))||['ADMIN'].includes(user.studentId)||['ADMIN'].includes(user.id));// 根据用户角色自动重定向\nif(isAdmin){return/*#__PURE__*/_jsx(Navigate,{to:\"/admin\",replace:true});}else{return/*#__PURE__*/_jsx(Navigate,{to:\"/student\",replace:true});}};// 学生端页面\nconst StudentPage=()=>{var _user$studentId2,_user$id2;const{user,isAuthenticated}=useApp();// 检查是否是管理员\nconst isAdmin=user&&(user.userType==='admin'||user.role==='admin'||((_user$studentId2=user.studentId)===null||_user$studentId2===void 0?void 0:_user$studentId2.startsWith('ADMIN'))||((_user$id2=user.id)===null||_user$id2===void 0?void 0:_user$id2.startsWith('ADMIN'))||['ADMIN'].includes(user.studentId)||['ADMIN'].includes(user.id));return/*#__PURE__*/_jsxs(\"div\",{className:\"w-full min-h-screen\",children:[/*#__PURE__*/_jsx(\"header\",{className:\"w-full bg-white p-4 shadow-md flex justify-center items-center sticky top-0 z-20\",children:/*#__PURE__*/_jsx(\"h1\",{className:\"text-xl font-bold text-gray-800\",children:\"\\u8003\\u7814\\u4EFB\\u52A1\\u7BA1\\u7406\\u7CFB\\u7EDF - \\u5B66\\u751F\\u7AEF\"})}),/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",element:/*#__PURE__*/_jsx(ProtectedRoute,{children:isAdmin?/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center min-h-[calc(100vh-80px)]\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center p-8\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-blue-600 mb-4\",children:\"\\u7BA1\\u7406\\u5458\\u8D26\\u53F7\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mb-4\",children:\"\\u60A8\\u4F7F\\u7528\\u7684\\u662F\\u7BA1\\u7406\\u5458\\u8D26\\u53F7\\uFF0C\\u8BF7\\u8BBF\\u95EE\\u7BA1\\u7406\\u5458\\u7AEF\\u3002\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.location.href='/admin',className:\"px-6 py-2 bg-blue-500 text-white rounded hover:bg-blue-600\",children:\"\\u524D\\u5F80\\u7BA1\\u7406\\u5458\\u7AEF\"})]})}):/*#__PURE__*/_jsx(StudentApp,{})})}),/*#__PURE__*/_jsx(Route,{path:\"*\",element:/*#__PURE__*/_jsx(Navigate,{to:\"/student\",replace:true})})]})]});};// 管理员端页面\nconst AdminPage=()=>{var _user$studentId3,_user$id3;const{user,isAuthenticated,refreshAuth}=useApp();// 检查是否是管理员 - 更严格的检查\nconst isAdmin=user&&(user.userType==='admin'||user.role==='admin'||((_user$studentId3=user.studentId)===null||_user$studentId3===void 0?void 0:_user$studentId3.startsWith('ADMIN'))||((_user$id3=user.id)===null||_user$id3===void 0?void 0:_user$id3.startsWith('ADMIN'))||['ADMIN'].includes(user.studentId)||['ADMIN'].includes(user.id));return/*#__PURE__*/_jsxs(\"div\",{className:\"w-full min-h-screen\",children:[/*#__PURE__*/_jsx(\"header\",{className:\"w-full bg-white p-4 shadow-md flex justify-center items-center sticky top-0 z-20\",children:/*#__PURE__*/_jsx(\"h1\",{className:\"text-xl font-bold text-gray-800\",children:\"\\u8003\\u7814\\u4EFB\\u52A1\\u7BA1\\u7406\\u7CFB\\u7EDF - \\u7BA1\\u7406\\u5458\\u7AEF\"})}),/*#__PURE__*/_jsx(ProtectedRoute,{children:isAdmin?/*#__PURE__*/_jsx(AdminDashboard,{}):/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center min-h-[calc(100vh-80px)]\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center p-8\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-red-600 mb-4\",children:\"\\u8BBF\\u95EE\\u88AB\\u62D2\\u7EDD\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mb-4\",children:\"\\u60A8\\u6CA1\\u6709\\u7BA1\\u7406\\u5458\\u6743\\u9650\\u8BBF\\u95EE\\u6B64\\u9875\\u9762\\u3002\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-500 mb-4\",children:[\"\\u5F53\\u524D\\u767B\\u5F55\\u7684\\u662F\\u5B66\\u751F\\u8D26\\u53F7 (\",(user===null||user===void 0?void 0:user.studentId)||(user===null||user===void 0?void 0:user.id),\")\\uFF0C\\u8BF7\\u4F7F\\u7528\\u7BA1\\u7406\\u5458\\u8D26\\u53F7\\u767B\\u5F55\\uFF1AADMIN\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2 mb-4\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>{localStorage.clear();window.location.href='/';},className:\"block mx-auto px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600\",children:\"\\u91CD\\u65B0\\u767B\\u5F55\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.location.href='/student',className:\"block mx-auto px-6 py-2 bg-blue-500 text-white rounded hover:bg-blue-600\",children:\"\\u8FD4\\u56DE\\u5B66\\u751F\\u7AEF\"})]})]})})})]});};function App(){return/*#__PURE__*/_jsx(AppProvider,{children:/*#__PURE__*/_jsx(Router,{children:/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",element:/*#__PURE__*/_jsx(HomePage,{})}),/*#__PURE__*/_jsx(Route,{path:\"/admin/*\",element:/*#__PURE__*/_jsx(AdminPage,{})}),/*#__PURE__*/_jsx(Route,{path:\"/student/*\",element:/*#__PURE__*/_jsx(StudentPage,{})}),/*#__PURE__*/_jsx(Route,{path:\"*\",element:/*#__PURE__*/_jsx(Navigate,{to:\"/\",replace:true})})]})})});}export default App;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}