{"ast":null,"code":"import React,{useState,useEffect}from'react';import{adminAPI}from'../services/api';import{useApp}from'../contexts/AppContext';import{performAdminReset,syncPasswordReset}from'../utils/dataConsistency';import*as XLSX from'xlsx';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const AdminDashboard=()=>{const{user,logout}=useApp();const[students,setStudents]=useState([]);const[selectedStudent,setSelectedStudent]=useState(null);const[studentProfile,setStudentProfile]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[showCreateForm,setShowCreateForm]=useState(false);const[newStudentName,setNewStudentName]=useState('');const[showExcelImportForm,setShowExcelImportForm]=useState(false);const[excelFile,setExcelFile]=useState(null);const[excelData,setExcelData]=useState([]);const[taskReport,setTaskReport]=useState(null);const[reportDate,setReportDate]=useState(new Date().toISOString().split('T')[0]);const[testMode,setTestMode]=useState(false);const[showTaskForm,setShowTaskForm]=useState(false);const[newTask,setNewTask]=useState({studentId:'',title:'',date:new Date().toISOString().split('T')[0],type:'å­¦ä¹ '});// èŽ·å–å­¦ç”Ÿåˆ—è¡¨\nconst fetchStudents=async()=>{try{setLoading(true);setError(null);const response=await adminAPI.getStudents();if(response.success){setStudents(response.data||[]);}else{setError(response.message||'èŽ·å–å­¦ç”Ÿåˆ—è¡¨å¤±è´¥');}}catch(err){setError(err.message||'ç½‘ç»œé”™è¯¯');}finally{setLoading(false);}};// èŽ·å–å­¦ç”Ÿæ¡£æ¡ˆ\nconst fetchStudentProfile=async studentId=>{try{const response=await adminAPI.getStudentProfile(studentId);if(response.success){setStudentProfile(response.data);}else{setError(response.message||'èŽ·å–å­¦ç”Ÿæ¡£æ¡ˆå¤±è´¥');}}catch(err){setError(err.message||'èŽ·å–å­¦ç”Ÿæ¡£æ¡ˆå¤±è´¥');}};// åˆ›å»ºå­¦ç”Ÿ\nconst createStudent=async()=>{if(!newStudentName.trim()){setError('è¯·è¾“å…¥å­¦ç”Ÿå§“å');return;}try{setError(null);const response=await adminAPI.createStudent(newStudentName);if(response.success){setNewStudentName('');setShowCreateForm(false);await fetchStudents();alert('å­¦ç”Ÿåˆ›å»ºæˆåŠŸ');}else{setError(response.message||'åˆ›å»ºå­¦ç”Ÿå¤±è´¥');}}catch(err){setError(err.message||'åˆ›å»ºå­¦ç”Ÿå¤±è´¥');}};// é‡ç½®å¯†ç \nconst resetPassword=async studentId=>{if(!window.confirm('ç¡®å®šè¦é‡ç½®è¯¥å­¦ç”Ÿçš„å¯†ç å—ï¼Ÿ')){return;}try{setError(null);console.log(`ðŸ”„ é‡ç½®å­¦ç”Ÿ ${studentId} çš„å¯†ç ...`);const response=await adminAPI.resetPassword(studentId);if(response.success){console.log('âœ… å¯†ç é‡ç½®æˆåŠŸ:',response.data);// ä½¿ç”¨æ•°æ®ä¸€è‡´æ€§å·¥å…·åŒæ­¥çŠ¶æ€\nsyncPasswordReset(studentId,setStudents,setSelectedStudent);alert(`âœ… å¯†ç é‡ç½®æˆåŠŸï¼\\næ–°å¯†ç ï¼š${response.data.initialPassword}\\nè¯¥å­¦ç”Ÿä¸‹æ¬¡ç™»å½•æ—¶éœ€è¦ä¿®æ”¹å¯†ç ã€‚`);}else{setError(response.message||'é‡ç½®å¯†ç å¤±è´¥');}}catch(err){console.error('âŒ é‡ç½®å¯†ç å¤±è´¥:',err);setError(err.message||'é‡ç½®å¯†ç å¤±è´¥');}};// åˆ›å»ºå•ä¸ªä»»åŠ¡\nconst createTask=async()=>{if(!newTask.studentId||!newTask.title.trim()){setError('è¯·é€‰æ‹©å­¦ç”Ÿå¹¶è¾“å…¥ä»»åŠ¡æ ‡é¢˜');return;}try{setError(null);const response=await adminAPI.createTask(newTask);if(response.success){setNewTask({studentId:'',title:'',date:new Date().toISOString().split('T')[0],type:'å­¦ä¹ '});setShowTaskForm(false);alert('ä»»åŠ¡åˆ›å»ºæˆåŠŸ');}else{setError(response.message||'åˆ›å»ºä»»åŠ¡å¤±è´¥');}}catch(err){setError(err.message||'åˆ›å»ºä»»åŠ¡å¤±è´¥');}};// å¤„ç†Excelæ–‡ä»¶ä¸Šä¼ \nconst handleExcelFileChange=event=>{const file=event.target.files[0];if(!file){return;}// æ¸…ç©ºinputçš„å€¼ï¼Œé¿å…é‡å¤é€‰æ‹©åŒä¸€æ–‡ä»¶æ—¶ä¸è§¦å‘changeäº‹ä»¶\nevent.target.value='';console.log('é€‰æ‹©çš„æ–‡ä»¶:',file.name,file.type,file.size);// éªŒè¯æ–‡ä»¶ç±»åž‹\nconst validTypes=['application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',// .xlsx\n'application/vnd.ms-excel'// .xls\n];if(!validTypes.includes(file.type)&&!file.name.match(/\\.(xlsx|xls)$/i)){setError('è¯·é€‰æ‹©æœ‰æ•ˆçš„Excelæ–‡ä»¶ (.xlsx æˆ– .xls)');return;}// éªŒè¯æ–‡ä»¶å¤§å° (æœ€å¤§5MB)\nif(file.size>5*1024*1024){setError('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡5MB');return;}setExcelFile(file);setError(null);const reader=new FileReader();reader.onload=e=>{try{console.log('å¼€å§‹è§£æžExcelæ–‡ä»¶...');const data=new Uint8Array(e.target.result);const workbook=XLSX.read(data,{type:'array'});// è¯»å–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨\nconst sheetName=workbook.SheetNames[0];const worksheet=workbook.Sheets[sheetName];// è½¬æ¢ä¸ºJSONæ ¼å¼\nconst jsonData=XLSX.utils.sheet_to_json(worksheet,{header:1});console.log('è§£æžçš„åŽŸå§‹æ•°æ®:',jsonData);// è¿‡æ»¤ç©ºè¡Œå¹¶æ ¼å¼åŒ–æ•°æ®\nconst formattedData=jsonData.filter(row=>row.length>0&&row.some(cell=>cell!==undefined&&cell!=='')).map(row=>({studentId:row[0]||'',date:row[1]||'',taskType:row[2]||'',title:row[3]||''}));console.log('æ ¼å¼åŒ–åŽçš„æ•°æ®:',formattedData);setExcelData(formattedData);setError(null);}catch(err){console.error('Excelè§£æžé”™è¯¯:',err);setError('Excelæ–‡ä»¶è§£æžå¤±è´¥: '+err.message);setExcelFile(null);setExcelData([]);}};reader.onerror=err=>{console.error('æ–‡ä»¶è¯»å–é”™è¯¯:',err);setError('æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·é‡è¯•');setExcelFile(null);setExcelData([]);};reader.readAsArrayBuffer(file);};// ä¸‹è½½Excelæ¨¡æ¿\nconst downloadExcelTemplate=()=>{try{// åˆ›å»ºç¤ºä¾‹æ•°æ® - ä»Ž7æœˆ19å·åˆ°7æœˆ31å·çš„å®Œæ•´ç¤ºä¾‹\nconst templateData=[['å­¦ç”ŸID','æ—¥æœŸ','ä»»åŠ¡ç±»åž‹','ä»»åŠ¡æ ‡é¢˜'],// 7æœˆ19æ—¥ - å‘¨å…­\n['ST001','2025-07-19','æ•°å­¦','é«˜ç­‰æ•°å­¦å¾®åˆ†å­¦'],['ST001','2025-07-19','è‹±è¯­','è€ƒç ”è¯æ±‡Unit1-10'],['ST001','2025-07-19','ä¸“ä¸šè¯¾','æ•°æ®ç»“æž„ä¸Žç®—æ³•åŸºç¡€'],['ST002','2025-07-19','æ•°å­¦','çº¿æ€§ä»£æ•°çŸ©é˜µè¿ç®—'],['ST002','2025-07-19','è‹±è¯­','é˜…è¯»ç†è§£ä¸“é¡¹è®­ç»ƒ'],['ST002','2025-07-19','ä¸“ä¸šè¯¾','è®¡ç®—æœºç½‘ç»œTCP/IP'],// 7æœˆ20æ—¥ - å‘¨æ—¥ï¼ˆä¼‘æ¯æ—¥ï¼‰\n['ST001','2025-07-20','ä¼‘æ¯','ä¼‘æ¯æ—¥'],['ST002','2025-07-20','ä¼‘æ¯','ä¼‘æ¯æ—¥'],// 7æœˆ21æ—¥ - å‘¨ä¸€\n['ST001','2025-07-21','æ•°å­¦','é«˜ç­‰æ•°å­¦ç§¯åˆ†å­¦'],['ST001','2025-07-21','è‹±è¯­','é˜…è¯»ç†è§£ä¸“é¡¹è®­ç»ƒ'],['ST001','2025-07-21','ä¸“ä¸šè¯¾','æ“ä½œç³»ç»Ÿè¿›ç¨‹ç®¡ç†'],['ST002','2025-07-21','æ•°å­¦','æ¦‚çŽ‡è®ºä¸Žæ•°ç†ç»Ÿè®¡'],['ST002','2025-07-21','è‹±è¯­','å®Œå½¢å¡«ç©ºä¸“é¡¹è®­ç»ƒ'],['ST002','2025-07-21','ä¸“ä¸šè¯¾','æ•°æ®åº“ç³»ç»ŸåŽŸç†'],// 7æœˆ22æ—¥ - å‘¨äºŒ\n['ST001','2025-07-22','æ•°å­¦','çº¿æ€§ä»£æ•°å‘é‡ç©ºé—´'],['ST001','2025-07-22','è‹±è¯­','ç¿»è¯‘æŠ€å·§è®­ç»ƒ'],['ST001','2025-07-22','ä¸“ä¸šè¯¾','è®¡ç®—æœºç»„æˆåŽŸç†'],['ST002','2025-07-22','æ•°å­¦','é«˜ç­‰æ•°å­¦æžé™ç†è®º'],['ST002','2025-07-22','è‹±è¯­','å†™ä½œæ¨¡æ¿ç»ƒä¹ '],['ST002','2025-07-22','ä¸“ä¸šè¯¾','è½¯ä»¶å·¥ç¨‹åŸºç¡€'],// 7æœˆ23æ—¥ - å‘¨ä¸‰\n['ST001','2025-07-23','æ•°å­¦','æ¦‚çŽ‡è®ºåŸºç¡€æ¦‚å¿µ'],['ST001','2025-07-23','è‹±è¯­','é•¿éš¾å¥åˆ†æž'],['ST001','2025-07-23','ä¸“ä¸šè¯¾','ç®—æ³•è®¾è®¡ä¸Žåˆ†æž'],['ST002','2025-07-23','æ•°å­¦','çº¿æ€§ä»£æ•°çŸ©é˜µå˜æ¢'],['ST002','2025-07-23','è‹±è¯­','è¯æ±‡è®°å¿†å¼ºåŒ–'],['ST002','2025-07-23','ä¸“ä¸šè¯¾','ç¼–è¯‘åŽŸç†åŸºç¡€'],// 7æœˆ24æ—¥ - å‘¨å››\n['ST001','2025-07-24','æ•°å­¦','æ•°ç†ç»Ÿè®¡å‡è®¾æ£€éªŒ'],['ST001','2025-07-24','è‹±è¯­','æ–°é¢˜åž‹è§£é¢˜æŠ€å·§'],['ST001','2025-07-24','ä¸“ä¸šè¯¾','äººå·¥æ™ºèƒ½å¯¼è®º'],['ST002','2025-07-24','æ•°å­¦','æ¦‚çŽ‡åˆ†å¸ƒä¸ŽæœŸæœ›'],['ST002','2025-07-24','è‹±è¯­','é˜…è¯»ç†è§£æé€Ÿè®­ç»ƒ'],['ST002','2025-07-24','ä¸“ä¸šè¯¾','æœºå™¨å­¦ä¹ åŸºç¡€'],// 7æœˆ25æ—¥ - å‘¨äº”\n['ST001','2025-07-25','æ•°å­¦','é«˜ç­‰æ•°å­¦å¤šå…ƒå‡½æ•°'],['ST001','2025-07-25','è‹±è¯­','ä½œæ–‡ç´ æç§¯ç´¯'],['ST001','2025-07-25','ä¸“ä¸šè¯¾','åˆ†å¸ƒå¼ç³»ç»Ÿæ¦‚å¿µ'],['ST002','2025-07-25','æ•°å­¦','çº¿æ€§ä»£æ•°ç‰¹å¾å€¼'],['ST002','2025-07-25','è‹±è¯­','å¬åŠ›ç†è§£è®­ç»ƒ'],['ST002','2025-07-25','ä¸“ä¸šè¯¾','äº‘è®¡ç®—æŠ€æœ¯'],// 7æœˆ26æ—¥ - å‘¨å…­\n['ST001','2025-07-26','æ•°å­¦','æ¦‚çŽ‡è®ºæ¡ä»¶æ¦‚çŽ‡'],['ST001','2025-07-26','è‹±è¯­','è¯­æ³•ç»¼åˆå¤ä¹ '],['ST001','2025-07-26','ä¸“ä¸šè¯¾','ç½‘ç»œå®‰å…¨åŸºç¡€'],['ST002','2025-07-26','æ•°å­¦','æ•°ç†ç»Ÿè®¡å‚æ•°ä¼°è®¡'],['ST002','2025-07-26','è‹±è¯­','æ¨¡æ‹Ÿè¯•é¢˜ç»ƒä¹ '],['ST002','2025-07-26','ä¸“ä¸šè¯¾','åŒºå—é“¾æŠ€æœ¯'],// 7æœˆ27æ—¥ - å‘¨æ—¥ï¼ˆä¼‘æ¯æ—¥ï¼‰\n['ST001','2025-07-27','ä¼‘æ¯','ä¼‘æ¯æ—¥'],['ST002','2025-07-27','ä¼‘æ¯','ä¼‘æ¯æ—¥'],// 7æœˆ28æ—¥ - å‘¨ä¸€\n['ST001','2025-07-28','æ•°å­¦','é«˜ç­‰æ•°å­¦é‡ç§¯åˆ†'],['ST001','2025-07-28','è‹±è¯­','çœŸé¢˜æ¨¡æ‹Ÿæµ‹è¯•'],['ST001','2025-07-28','ä¸“ä¸šè¯¾','å›¾è®ºä¸Žç¦»æ•£æ•°å­¦'],['ST002','2025-07-28','æ•°å­¦','çº¿æ€§ä»£æ•°äºŒæ¬¡åž‹'],['ST002','2025-07-28','è‹±è¯­','é”™é¢˜åˆ†æžæ€»ç»“'],['ST002','2025-07-28','ä¸“ä¸šè¯¾','æ•°å€¼åˆ†æžæ–¹æ³•'],// 7æœˆ29æ—¥ - å‘¨äºŒ\n['ST001','2025-07-29','æ•°å­¦','æ¦‚çŽ‡è®ºå¤§æ•°å®šå¾‹'],['ST001','2025-07-29','è‹±è¯­','è€ƒå‰å†²åˆºå¤ä¹ '],['ST001','2025-07-29','ä¸“ä¸šè¯¾','ä¿¡æ¯è®ºåŸºç¡€'],['ST002','2025-07-29','æ•°å­¦','æ•°ç†ç»Ÿè®¡åŒºé—´ä¼°è®¡'],['ST002','2025-07-29','è‹±è¯­','åº”è¯•æŠ€å·§è®­ç»ƒ'],['ST002','2025-07-29','ä¸“ä¸šè¯¾','å¯†ç å­¦åŽŸç†'],// 7æœˆ30æ—¥ - å‘¨ä¸‰\n['ST001','2025-07-30','æ•°å­¦','é«˜ç­‰æ•°å­¦æ›²çº¿ç§¯åˆ†'],['ST001','2025-07-30','è‹±è¯­','å†™ä½œæ¨¡æ¿è¿ç”¨'],['ST001','2025-07-30','ä¸“ä¸šè¯¾','é‡å­è®¡ç®—å…¥é—¨'],['ST002','2025-07-30','æ•°å­¦','çº¿æ€§ä»£æ•°ç»¼åˆåº”ç”¨'],['ST002','2025-07-30','è‹±è¯­','å£è¯­è¡¨è¾¾ç»ƒä¹ '],['ST002','2025-07-30','ä¸“ä¸šè¯¾','ç”Ÿç‰©ä¿¡æ¯å­¦'],// 7æœˆ31æ—¥ - å‘¨å››\n['ST001','2025-07-31','æ•°å­¦','æ¦‚çŽ‡ç»Ÿè®¡ç»¼åˆå¤ä¹ '],['ST001','2025-07-31','è‹±è¯­','å…¨çœŸæ¨¡æ‹Ÿè€ƒè¯•'],['ST001','2025-07-31','ä¸“ä¸šè¯¾','å‰æ²¿æŠ€æœ¯è°ƒç ”'],['ST002','2025-07-31','æ•°å­¦','é«˜ç­‰æ•°å­¦æ€»ç»“å›žé¡¾'],['ST002','2025-07-31','è‹±è¯­','è€ƒè¯•å¿ƒç†è°ƒé€‚'],['ST002','2025-07-31','ä¸“ä¸šè¯¾','é¡¹ç›®å®žè·µæ€»ç»“']];// åˆ›å»ºå·¥ä½œç°¿\nconst wb=XLSX.utils.book_new();const ws=XLSX.utils.aoa_to_sheet(templateData);// è®¾ç½®åˆ—å®½\nws['!cols']=[{width:12},// å­¦ç”ŸID\n{width:15},// æ—¥æœŸ\n{width:12},// ä»»åŠ¡ç±»åž‹\n{width:30}// ä»»åŠ¡æ ‡é¢˜\n];// æ·»åŠ å·¥ä½œè¡¨\nXLSX.utils.book_append_sheet(wb,ws,'ä»»åŠ¡å¯¼å…¥æ¨¡æ¿');// ç”ŸæˆExcelæ–‡ä»¶çš„äºŒè¿›åˆ¶æ•°æ®\nconst excelBuffer=XLSX.write(wb,{bookType:'xlsx',type:'array'});// åˆ›å»ºBlobå¯¹è±¡\nconst blob=new Blob([excelBuffer],{type:'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'});// åˆ›å»ºä¸‹è½½é“¾æŽ¥\nconst url=window.URL.createObjectURL(blob);const link=document.createElement('a');link.href=url;// ä½¿ç”¨è‹±æ–‡æ–‡ä»¶åé¿å…ç¼–ç é—®é¢˜\nconst fileName='task_import_template.xlsx';link.download=fileName;// è®¾ç½®ä¸‹è½½å±žæ€§ä»¥ç¡®ä¿æ­£ç¡®çš„æ–‡ä»¶å\nlink.setAttribute('download',fileName);// è§¦å‘ä¸‹è½½\ndocument.body.appendChild(link);link.click();// æ¸…ç†\ndocument.body.removeChild(link);window.URL.revokeObjectURL(url);console.log('âœ… Excelæ¨¡æ¿ä¸‹è½½æˆåŠŸ');}catch(error){console.error('âŒ Excelæ¨¡æ¿ä¸‹è½½å¤±è´¥:',error);setError('ä¸‹è½½æ¨¡æ¿å¤±è´¥ï¼Œè¯·é‡è¯•');}};// ä»ŽExcelæ•°æ®å¯¼å…¥ä»»åŠ¡\nconst importFromExcel=async()=>{if(!excelData||excelData.length===0){setError('è¯·å…ˆé€‰æ‹©å¹¶è§£æžExcelæ–‡ä»¶');return;}try{setError(null);// å°†Excelæ•°æ®è½¬æ¢ä¸ºCSVæ ¼å¼\nconst csvContent=excelData.filter(row=>row.studentId&&row.date&&row.taskType&&row.title).map(row=>`${row.studentId},${row.date},${row.taskType},${row.title}`).join('\\n');if(!csvContent){setError('Excelæ–‡ä»¶ä¸­æ²¡æœ‰æœ‰æ•ˆçš„ä»»åŠ¡æ•°æ®');return;}const fullCsvData='å­¦ç”ŸID,æ—¥æœŸ,ä»»åŠ¡ç±»åž‹,ä»»åŠ¡æ ‡é¢˜\\n'+csvContent;const response=await adminAPI.bulkImportTasks(fullCsvData);if(response.success){setExcelFile(null);setExcelData([]);setShowExcelImportForm(false);alert(`æˆåŠŸä»ŽExcelå¯¼å…¥ ${response.data.imported} ä¸ªä»»åŠ¡`);}else{setError(response.message||'å¯¼å…¥ä»»åŠ¡å¤±è´¥');}}catch(err){setError(err.message||'å¯¼å…¥ä»»åŠ¡å¤±è´¥');}};// ç®¡ç†å‘˜é‡ç½®æ‰€æœ‰ä»»åŠ¡æ•°æ®\nconst resetAllTasks=async()=>{// ä½¿ç”¨ä¸“ç”¨çš„ç®¡ç†å‘˜é‡ç½®å·¥å…·\nconst result=await performAdminReset(adminAPI.resetAllTasks,setStudents,setSelectedStudent,setTaskReport);if(result.success){console.log('âœ… ç®¡ç†å‘˜é‡ç½®æˆåŠŸ:',result.data);// é‡ç½®æŠ¥å‘Šæ—¥æœŸ\nsetReportDate(new Date().toISOString().split('T')[0]);}else if(!result.cancelled){console.error('âŒ ç®¡ç†å‘˜é‡ç½®å¤±è´¥:',result.error);setError(result.error);}};// èŽ·å–ä»»åŠ¡æŠ¥å‘Š\nconst fetchTaskReport=async()=>{try{setError(null);const response=await adminAPI.getTaskReport(reportDate);if(response.success){setTaskReport(response.data);}else{setError(response.message||'èŽ·å–æŠ¥å‘Šå¤±è´¥');}}catch(err){setError(err.message||'èŽ·å–æŠ¥å‘Šå¤±è´¥');}};// é€‰æ‹©å­¦ç”Ÿ\nconst selectStudent=async student=>{setSelectedStudent(student);await fetchStudentProfile(student.id);};// æ¨¡æ‹Ÿæµ‹è¯•æ•°æ®\nconst loadTestData=()=>{setTestMode(true);setError(null);setLoading(false);setStudents([{id:'ST001',name:'å¼ ä¸‰',lastLoginAt:'2024-01-15T10:30:00.000Z',createdAt:'2024-01-01T00:00:00.000Z'},{id:'ST002',name:'æŽå››',lastLoginAt:'2024-01-14T09:15:00.000Z',createdAt:'2024-01-02T00:00:00.000Z'},{id:'ST003',name:'çŽ‹äº”',lastLoginAt:null,createdAt:'2024-01-03T00:00:00.000Z'}]);};useEffect(()=>{if(!testMode){// æ£€æŸ¥æ˜¯å¦æœ‰tokenï¼Œå¦‚æžœæ²¡æœ‰åˆ™è‡ªåŠ¨è¿›è¡Œç®¡ç†å‘˜ç™»å½•\nconst token=localStorage.getItem('token');if(!token){handleAdminLogin();}else{fetchStudents();}}},[testMode]);// ç®¡ç†å‘˜å¿«é€Ÿç™»å½•\nconst handleAdminLogin=async()=>{try{setError(null);const response=await fetch('/api/auth/admin/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({studentId:'ADMIN',password:'AdminPass123'})});const data=await response.json();if(data.success){localStorage.setItem('token',data.data.token);localStorage.setItem('user',JSON.stringify({...data.data.admin,studentId:data.data.admin.id,// ä¸ºäº†å…¼å®¹æ€§\nuserType:'admin'}));window.location.reload();// é‡æ–°åŠ è½½é¡µé¢ä»¥æ›´æ–°è®¤è¯çŠ¶æ€\n}else{setError('ç®¡ç†å‘˜ç™»å½•å¤±è´¥: '+data.message);}}catch(err){setError('ç®¡ç†å‘˜ç™»å½•å¤±è´¥: '+err.message);}};// é€€å‡ºç™»å½•\nconst handleLogout=()=>{logout();window.location.href='/admin';// é‡å®šå‘åˆ°ç®¡ç†å‘˜ç™»å½•é¡µé¢\n};if(loading){return/*#__PURE__*/_jsx(\"div\",{\"data-testid\":\"admin-dashboard\",className:\"p-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-gray-600\",children:\"\\u52A0\\u8F7D\\u4E2D...\"})]})});}return/*#__PURE__*/_jsxs(\"div\",{\"data-testid\":\"admin-dashboard\",className:\"p-6 max-w-7xl mx-auto\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6 flex justify-between items-start\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-800 mb-2\",children:\"\\u7BA1\\u7406\\u5458\\u63A7\\u5236\\u53F0\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"\\u7BA1\\u7406\\u5B66\\u751F\\u3001\\u4EFB\\u52A1\\u548C\\u67E5\\u770B\\u7CFB\\u7EDF\\u62A5\\u544A\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[user&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-right\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:\"\\u6B22\\u8FCE\\u56DE\\u6765\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-medium text-gray-800\",children:[user.name,\" (\",user.id||user.studentId,\")\"]})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleLogout,className:\"px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDEAA\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u9000\\u51FA\\u767B\\u5F55\"})]})]})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-md\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{children:error}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleAdminLogin,className:\"px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600\",children:\"\\uD83D\\uDD10 \\u7BA1\\u7406\\u5458\\u767B\\u5F55\"}),/*#__PURE__*/_jsx(\"button\",{onClick:loadTestData,className:\"px-3 py-1 bg-yellow-500 text-white text-sm rounded hover:bg-yellow-600\",children:\"\\uD83E\\uDDEA \\u4F7F\\u7528\\u6D4B\\u8BD5\\u6570\\u636E\"})]})]})}),testMode&&/*#__PURE__*/_jsx(\"div\",{className:\"mb-4 p-4 bg-yellow-100 border border-yellow-400 text-yellow-800 rounded-md\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83E\\uDDEA \\u5F53\\u524D\\u4F7F\\u7528\\u6D4B\\u8BD5\\u6570\\u636E\\u6A21\\u5F0F\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setTestMode(false);setStudents([]);fetchStudents();},className:\"ml-4 px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600\",children:\"\\u91CD\\u65B0\\u8FDE\\u63A5API\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-3 gap-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"lg:col-span-2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-md p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold text-gray-800\",children:\"\\u5B66\\u751F\\u7BA1\\u7406\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowCreateForm(true),className:\"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600\",children:\"\\u6DFB\\u52A0\\u5B66\\u751F\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-3\",children:students.map(student=>/*#__PURE__*/_jsx(\"div\",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${(selectedStudent===null||selectedStudent===void 0?void 0:selectedStudent.id)===student.id?'border-blue-500 bg-blue-50':'border-gray-200 hover:border-gray-300'}`,onClick:()=>selectStudent(student),children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-gray-800\",children:student.name}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600\",children:[\"ID: \",student.id]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600\",children:[\"\\u6CE8\\u518C\\u65F6\\u95F4: \",new Date(student.created_at).toLocaleDateString('zh-CN')]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col space-y-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:`px-2 py-1 rounded text-xs ${student.status==='active'?'bg-green-100 text-green-800':'bg-gray-100 text-gray-800'}`,children:student.status==='active'?'æ´»è·ƒ':'éžæ´»è·ƒ'}),/*#__PURE__*/_jsx(\"button\",{onClick:e=>{e.stopPropagation();resetPassword(student.id);},className:\"px-3 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600\",children:\"\\u91CD\\u7F6E\\u5BC6\\u7801\"})]})]})},student.id))}),students.length===0&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-400 text-6xl mb-4\",children:\"\\uD83D\\uDC65\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-600 mb-2\",children:\"\\u6682\\u65E0\\u5B66\\u751F\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"\\u70B9\\u51FB\\\"\\u6DFB\\u52A0\\u5B66\\u751F\\\"\\u6309\\u94AE\\u521B\\u5EFA\\u7B2C\\u4E00\\u4E2A\\u5B66\\u751F\\u8D26\\u6237\\u3002\"})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[selectedStudent&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-md p-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-800 mb-4\",children:\"\\u5B66\\u751F\\u8BE6\\u60C5\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-500\",children:\"\\u59D3\\u540D\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-gray-900\",children:selectedStudent.name})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-500\",children:\"\\u5B66\\u751FID\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-gray-900 font-mono\",children:selectedStudent.id})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-500\",children:\"\\u6700\\u540E\\u767B\\u5F55\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-gray-900\",children:selectedStudent.last_login_at?new Date(selectedStudent.last_login_at).toLocaleString('zh-CN'):'ä»Žæœªç™»å½•'})]}),studentProfile&&studentProfile.profile&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-500\",children:\"\\u6027\\u522B\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-gray-900\",children:studentProfile.profile.gender||'æœªå¡«å†™'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-500\",children:\"\\u5E74\\u9F84\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-gray-900\",children:studentProfile.profile.age||'æœªå¡«å†™'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-500\",children:\"\\u5B66\\u4E60\\u72B6\\u6001\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-gray-900\",children:studentProfile.profile.studyStatus==='å…¶ä»–'?studentProfile.profile.studyStatusOther||'æœªå¡«å†™':studentProfile.profile.studyStatus||'æœªå¡«å†™'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-500\",children:\"\\u6570\\u5B66\\u7C7B\\u578B\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-gray-900\",children:studentProfile.profile.mathType==='å…¶ä»–'?studentProfile.profile.mathTypeOther||'æœªå¡«å†™':studentProfile.profile.mathType||'æœªå¡«å†™'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-500\",children:\"\\u76EE\\u6807\\u5206\\u6570\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-gray-900\",children:studentProfile.profile.targetScore||'æœªå¡«å†™'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-500\",children:\"\\u6BCF\\u65E5\\u5B66\\u4E60\\u5C0F\\u65F6\\u6570\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-gray-900\",children:studentProfile.profile.dailyHours||'æœªå¡«å†™'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-500\",children:\"\\u9AD8\\u8003\\u4FE1\\u606F\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-gray-900\",children:studentProfile.profile.gaokaoYear!=='æœªå‚åŠ '?`${studentProfile.profile.gaokaoYear}å¹´ ${studentProfile.profile.gaokaoProvince} ${studentProfile.profile.gaokaoScore}åˆ†`:'æœªå‚åŠ '})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-500\",children:\"\\u8003\\u7814\\u4FE1\\u606F\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-gray-900\",children:studentProfile.profile.gradExamYear!=='æœªå‚åŠ '?`${studentProfile.profile.gradExamYear}å¹´ ${studentProfile.profile.gradExamMathType} ${studentProfile.profile.gradExamScore}åˆ†`:'æœªå‚åŠ '})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-500\",children:\"\\u4E13\\u5347\\u672C\\u4FE1\\u606F\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-gray-900\",children:studentProfile.profile.upgradeExamYear!=='æœªå‚åŠ '?`${studentProfile.profile.upgradeExamYear}å¹´ ${studentProfile.profile.upgradeExamProvince} ${studentProfile.profile.upgradeExamMathType} ${studentProfile.profile.upgradeExamScore}åˆ†`:'æœªå‚åŠ '})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-500\",children:\"\\u5DF2\\u8D2D\\u4E70\\u56FE\\u4E66\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-gray-900\",children:studentProfile.profile.purchasedBooks||'æœªå¡«å†™'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-500\",children:\"\\u7279\\u6B8A\\u9700\\u6C42\\u5907\\u6CE8\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-gray-900\",children:studentProfile.profile.notes||'æœªå¡«å†™'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-500\",children:\"\\u6863\\u6848\\u72B6\\u6001\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-gray-900\",children:/*#__PURE__*/_jsx(\"span\",{className:`px-2 py-1 rounded text-xs ${studentProfile.profile.isProfileSubmitted?'bg-green-100 text-green-800':'bg-yellow-100 text-yellow-800'}`,children:studentProfile.profile.isProfileSubmitted?'å·²æäº¤':'æœªæäº¤'})})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-500\",children:\"\\u6700\\u540E\\u66F4\\u65B0\\u65F6\\u95F4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-gray-900\",children:studentProfile.profile.updatedAt?new Date(studentProfile.profile.updatedAt).toLocaleString('zh-CN'):'æœªæ›´æ–°'})]})]}),studentProfile&&!studentProfile.profile&&/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"\\u8BE5\\u5B66\\u751F\\u5C1A\\u672A\\u586B\\u5199\\u6863\\u6848\\u4FE1\\u606F\"})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-md p-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-800 mb-4\",children:\"\\u5FEB\\u901F\\u64CD\\u4F5C\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowTaskForm(true),className:\"w-full px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 text-sm\",children:\"\\uD83D\\uDCDD \\u521B\\u5EFA\\u4EFB\\u52A1\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowExcelImportForm(true),className:\"w-full px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 text-sm\",children:\"\\uD83D\\uDCCA Excel\\u6279\\u91CF\\u5BFC\\u5165\\u4EFB\\u52A1\"}),/*#__PURE__*/_jsx(\"button\",{onClick:resetAllTasks,className:\"w-full px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 text-sm\",children:\"\\uD83D\\uDDD1\\uFE0F \\u91CD\\u7F6E\\u6240\\u6709\\u4EFB\\u52A1\\u6570\\u636E\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"\\u62A5\\u544A\\u65E5\\u671F\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:reportDate,onChange:e=>setReportDate(e.target.value),className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:fetchTaskReport,className:\"w-full px-4 py-2 bg-purple-500 text-white rounded-md hover:bg-purple-600 text-sm\",children:\"\\u751F\\u6210\\u4EFB\\u52A1\\u62A5\\u544A\"}),/*#__PURE__*/_jsx(\"button\",{onClick:fetchStudents,className:\"w-full px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 text-sm\",children:\"\\u5237\\u65B0\\u6570\\u636E\"})]})]}),taskReport&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-md p-6\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-gray-800 mb-4\",children:[\"\\u4EFB\\u52A1\\u62A5\\u544A (\",reportDate,\")\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3 text-sm mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:\"\\u603B\\u4EFB\\u52A1\\u6570\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:taskReport.totalTasks||0})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:\"\\u5DF2\\u5B8C\\u6210\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold text-green-600\",children:taskReport.completedTasks||0})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:\"\\u5B8C\\u6210\\u7387\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-semibold\",children:[taskReport.completionRate||0,\"%\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:\"\\u6D3B\\u8DC3\\u5B66\\u751F\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:taskReport.activeStudents||0})]})]}),taskReport.studentStats&&taskReport.studentStats.length>0&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-md font-medium text-gray-700 mb-3\",children:\"\\u5B66\\u751F\\u5B8C\\u6210\\u60C5\\u51B5\"}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-2\",children:taskReport.studentStats.map(student=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center p-2 bg-gray-50 rounded\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-700\",children:student.studentName}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-gray-600\",children:[student.completedTasks,\"/\",student.totalTasks]}),/*#__PURE__*/_jsxs(\"span\",{className:`ml-2 font-medium ${student.completionRate>=80?'text-green-600':student.completionRate>=60?'text-yellow-600':'text-red-600'}`,children:[student.completionRate,\"%\"]})]})]},student.studentId))})]}),taskReport.totalTasks===0&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-4 text-gray-500\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\u8BE5\\u65E5\\u671F\\u6CA1\\u6709\\u4EFB\\u52A1\\u6570\\u636E\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm mt-1\",children:\"\\u8BF7\\u9009\\u62E9\\u5176\\u4ED6\\u65E5\\u671F\\u6216\\u5148\\u5BFC\\u5165\\u4EFB\\u52A1\\u6570\\u636E\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-md p-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-800 mb-4\",children:\"\\u7CFB\\u7EDF\\u7EDF\\u8BA1\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:\"\\u603B\\u5B66\\u751F\\u6570\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:students.length})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:\"\\u6D3B\\u8DC3\\u5B66\\u751F\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold text-green-600\",children:students.filter(s=>s.status==='active').length})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:\"\\u4ECA\\u65E5\\u767B\\u5F55\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:students.filter(s=>{if(!s.last_login_at)return false;const today=new Date().toDateString();const loginDate=new Date(s.last_login_at).toDateString();return today===loginDate;}).length})]})]})]})]})]}),showCreateForm&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg p-6 w-full max-w-md\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-800 mb-4\",children:\"\\u6DFB\\u52A0\\u65B0\\u5B66\\u751F\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:[\"\\u5B66\\u751F\\u59D3\\u540D \",/*#__PURE__*/_jsx(\"span\",{className:\"text-red-500\",children:\"*\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:newStudentName,onChange:e=>setNewStudentName(e.target.value),className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500\",placeholder:\"\\u8BF7\\u8F93\\u5165\\u5B66\\u751F\\u59D3\\u540D\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:createStudent,className:\"flex-1 px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600\",children:\"\\u521B\\u5EFA\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setShowCreateForm(false);setNewStudentName('');},className:\"flex-1 px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600\",children:\"\\u53D6\\u6D88\"})]})]})]})}),showExcelImportForm&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg p-6 w-full max-w-4xl\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-800 mb-4\",children:\"\\uD83D\\uDCCA Excel\\u6279\\u91CF\\u5BFC\\u5165\\u4EFB\\u52A1\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"\\u9009\\u62E9Excel\\u6587\\u4EF6 (.xlsx, .xls)\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:downloadExcelTemplate,className:\"px-3 py-1 bg-blue-500 text-white text-sm rounded-md hover:bg-blue-600 flex items-center space-x-1\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDCE5\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u4E0B\\u8F7D\\u6A21\\u677F\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",id:\"excel-file-input\",accept:\".xlsx,.xls\",onChange:handleExcelFileChange,className:\"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-full px-3 py-2 border border-gray-300 rounded-md hover:bg-gray-50 cursor-pointer text-left flex items-center justify-center space-x-2 bg-white\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDCC1\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-700\",children:excelFile?`å·²é€‰æ‹©: ${excelFile.name}`:'ç‚¹å‡»é€‰æ‹©Excelæ–‡ä»¶'})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-blue-50 border border-blue-200 rounded-md p-3\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-blue-700 font-medium mb-1\",children:\"\\uD83D\\uDCCB Excel\\u6587\\u4EF6\\u683C\\u5F0F\\u8981\\u6C42\\uFF1A\"}),/*#__PURE__*/_jsxs(\"ul\",{className:\"text-xs text-blue-600 space-y-1\",children:[/*#__PURE__*/_jsx(\"li\",{children:\"\\u2022 \\u7B2C\\u4E00\\u5217\\uFF1A\\u5B66\\u751FID\\uFF08\\u5982\\uFF1AST001\\uFF09\"}),/*#__PURE__*/_jsx(\"li\",{children:\"\\u2022 \\u7B2C\\u4E8C\\u5217\\uFF1A\\u65E5\\u671F\\uFF08\\u683C\\u5F0F\\uFF1AYYYY-MM-DD\\uFF0C\\u5982\\uFF1A2025-07-19\\uFF09\"}),/*#__PURE__*/_jsx(\"li\",{children:\"\\u2022 \\u7B2C\\u4E09\\u5217\\uFF1A\\u4EFB\\u52A1\\u7C7B\\u578B\\uFF08\\u5982\\uFF1A\\u6570\\u5B66\\u3001\\u82F1\\u8BED\\u3001\\u4E13\\u4E1A\\u8BFE\\u3001\\u4F11\\u606F\\uFF09\"}),/*#__PURE__*/_jsx(\"li\",{children:\"\\u2022 \\u7B2C\\u56DB\\u5217\\uFF1A\\u4EFB\\u52A1\\u6807\\u9898\\uFF08\\u5982\\uFF1A\\u9AD8\\u7B49\\u6570\\u5B66\\u5FAE\\u5206\\u5B66\\u3001\\u5348\\u4F11\\u3001\\u8BFE\\u95F4\\u4F11\\u606F\\uFF09\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 p-2 bg-green-50 border border-green-200 rounded\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-green-700 font-medium\",children:\"\\uD83C\\uDF1F \\u4F11\\u606F\\u4EFB\\u52A1\\u793A\\u4F8B\\uFF1A\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-green-600\",children:\"\\u4EFB\\u52A1\\u7C7B\\u578B\\u586B\\u5199\\\"\\u4F11\\u606F\\\"\\uFF0C\\u6807\\u9898\\u53EF\\u4EE5\\u662F\\uFF1A\\u5348\\u4F11\\u3001\\u8BFE\\u95F4\\u4F11\\u606F\\u3001\\u665A\\u95F4\\u653E\\u677E\\u3001\\u8FD0\\u52A8\\u65F6\\u95F4\\u7B49\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-blue-600 mt-2\",children:\"\\uD83D\\uDCA1 \\u5EFA\\u8BAE\\u5148\\u4E0B\\u8F7D\\u6A21\\u677F\\u6587\\u4EF6\\uFF0C\\u53C2\\u8003\\u793A\\u4F8B\\u6570\\u636E\\u683C\\u5F0F\\u8FDB\\u884C\\u586B\\u5199\"})]})]}),excelData.length>0&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"text-md font-medium text-gray-700 mb-2\",children:[\"\\u6570\\u636E\\u9884\\u89C8 (\\u5171 \",excelData.length,\" \\u884C)\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"max-h-64 overflow-y-auto border border-gray-300 rounded-md\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"w-full text-sm\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50 sticky top-0\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-3 py-2 text-left\",children:\"\\u5B66\\u751FID\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-3 py-2 text-left\",children:\"\\u65E5\\u671F\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-3 py-2 text-left\",children:\"\\u4EFB\\u52A1\\u7C7B\\u578B\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-3 py-2 text-left\",children:\"\\u4EFB\\u52A1\\u6807\\u9898\"})]})}),/*#__PURE__*/_jsxs(\"tbody\",{children:[excelData.slice(0,10).map((row,index)=>/*#__PURE__*/_jsxs(\"tr\",{className:index%2===0?'bg-white':'bg-gray-50',children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-3 py-2 border-t\",children:row.studentId}),/*#__PURE__*/_jsx(\"td\",{className:\"px-3 py-2 border-t\",children:row.date}),/*#__PURE__*/_jsx(\"td\",{className:\"px-3 py-2 border-t\",children:row.taskType}),/*#__PURE__*/_jsx(\"td\",{className:\"px-3 py-2 border-t\",children:row.title})]},index)),excelData.length>10&&/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsxs(\"td\",{colSpan:\"4\",className:\"px-3 py-2 text-center text-gray-500 border-t\",children:[\"... \\u8FD8\\u6709 \",excelData.length-10,\" \\u884C\\u6570\\u636E\"]})})]})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-3\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:importFromExcel,disabled:!excelData.length,className:`flex-1 px-4 py-2 rounded-md ${excelData.length?'bg-green-500 text-white hover:bg-green-600':'bg-gray-300 text-gray-500 cursor-not-allowed'}`,children:[\"\\u5BFC\\u5165 (\",excelData.length,\" \\u6761\\u8BB0\\u5F55)\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setShowExcelImportForm(false);setExcelFile(null);setExcelData([]);},className:\"flex-1 px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600\",children:\"\\u53D6\\u6D88\"})]})]})]})}),showTaskForm&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg p-6 w-full max-w-md\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-800 mb-4\",children:\"\\u521B\\u5EFA\\u65B0\\u4EFB\\u52A1\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:[\"\\u9009\\u62E9\\u5B66\\u751F \",/*#__PURE__*/_jsx(\"span\",{className:\"text-red-500\",children:\"*\"})]}),/*#__PURE__*/_jsxs(\"select\",{value:newTask.studentId,onChange:e=>setNewTask({...newTask,studentId:e.target.value}),className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\u8BF7\\u9009\\u62E9\\u5B66\\u751F\"}),students.map(student=>/*#__PURE__*/_jsxs(\"option\",{value:student.id,children:[student.name,\" (\",student.id,\")\"]},student.id))]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:[\"\\u4EFB\\u52A1\\u6807\\u9898 \",/*#__PURE__*/_jsx(\"span\",{className:\"text-red-500\",children:\"*\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:newTask.title,onChange:e=>setNewTask({...newTask,title:e.target.value}),className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500\",placeholder:\"\\u8BF7\\u8F93\\u5165\\u4EFB\\u52A1\\u6807\\u9898\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"\\u4EFB\\u52A1\\u65E5\\u671F\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:newTask.date,onChange:e=>setNewTask({...newTask,date:e.target.value}),className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"\\u4EFB\\u52A1\\u7C7B\\u578B\"}),/*#__PURE__*/_jsxs(\"select\",{value:newTask.type,onChange:e=>setNewTask({...newTask,type:e.target.value}),className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\\u5B66\\u4E60\",children:\"\\u5B66\\u4E60\"}),/*#__PURE__*/_jsx(\"option\",{value:\"\\u590D\\u4E60\",children:\"\\u590D\\u4E60\"}),/*#__PURE__*/_jsx(\"option\",{value:\"\\u7EC3\\u4E60\",children:\"\\u7EC3\\u4E60\"}),/*#__PURE__*/_jsx(\"option\",{value:\"\\u4F5C\\u4E1A\",children:\"\\u4F5C\\u4E1A\"}),/*#__PURE__*/_jsx(\"option\",{value:\"\\u5176\\u4ED6\",children:\"\\u5176\\u4ED6\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:createTask,className:\"flex-1 px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600\",children:\"\\u521B\\u5EFA\\u4EFB\\u52A1\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setShowTaskForm(false);setNewTask({studentId:'',title:'',date:new Date().toISOString().split('T')[0],type:'å­¦ä¹ '});},className:\"flex-1 px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600\",children:\"\\u53D6\\u6D88\"})]})]})]})})]});};export default AdminDashboard;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}